@page "/sync"
@using FiscalLabApp.Services

@inject SyncService SyncService

<PageTitle>Index</PageTitle>

<h1>Hello, world!</h1>

<button class="btn btn-primary" @onclick="() => ModalDialog.Open()">Click me!</button>

<ModalDialog @ref="@ModalDialog" Title="Sincronizar Dados">
    <div class="d-flex justify-content-end">
        <button class="btn btn-primary" type="button" disabled="@ShowSpinner" @onclick="SyncA">
            @if (ShowSpinner)
            {
                <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
            }
            @($"  {Status}")
        </button>
    </div>
    
</ModalDialog>

@code {
    private ModalDialog ModalDialog { get; set; } = null!;

    private bool ShowSpinner { get; set; }
    private string Status { get; set; } = "Sincronizar";

    private async Task SyncA()
    {
        try
        {
            Status = "Sincronizando....";
            ShowSpinner = true;
            StateHasChanged();
            await SyncService.SyncAsync();

            Status = "Sincronizar";
            StateHasChanged();
        }
        catch (Exception e)
        {
            Status = e.Message;
        }
        finally
        {
            ShowSpinner = false;
        }
    }

}